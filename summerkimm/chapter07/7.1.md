# 7ì¥ ë¹„ë™ê¸° í˜¸ì¶œ

## 7.1 API ìš”ì²­

### 1. fetchë¡œ API ìš”ì²­í•˜ê¸°

```ts
const CartBadge: React.FC = () => {
  const [cartCount, setCartCount] = useState(0);

  useEffect(() => {
    fetch("https://api.baemin.com/cart").then(({ cartItem }) => {
      setCartCount(cartItem.length);
    });
  }, []);

  // cartCount ìƒíƒœë¥¼ ì´ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
};
```

### 3. AXIOS í™œìš©í•˜ê¸°

```ts
const apiRequest: AxiosInstance = axios.create(defaultConfig);
const orderApiRequester: AxiosInstance = axios.create({
  baseURL: "https://api.baemin.or/",
  ...defaultConfig,
});
const orderCartApiRequester: AxiosInstance = axios.create({
  baseURL: "https://api.baemin.order/",
  ...defaultConfig,
});
```

ê° ì„œë²„(ì£¼ë¬¸ì„ ì²˜ë¦¬í•˜ëŠ” ì„œë²„ì™€ ì¥ë°”êµ¬ë‹ˆë¥¼ ì²˜ë¦¬í•˜ëŠ” ì„œë²„)ê°€ ë‹´ë‹¹í•˜ëŠ” ë¶€ë¶„ì´ ë‹¬ë¼ ê¸°ì¡´ì— ì‚¬ìš©í•˜ëŠ” API Entry(Base URL)ì™€ëŠ” ë‹¤ë¥¸ ìƒˆë¡œìš´ URLë¡œ ìš”ì²­í•´ì•¼ í•˜ëŠ” ìƒí™©  
API Entryê°€ 2ê°œ ì´ìƒì¼ ê²½ìš°ì—ëŠ” ê° ì„œë²„ì˜ ê¸°ë³¸ URLì„ í˜¸ì¶œí•˜ë„ë¡ `orderApiRequester`, `orderCartApiRequester` ê°™ì´ 2ê°œ ì´ìƒì˜ API ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë”°ë¡œ êµ¬ì„±í•´ì•¼ í•œë‹¤.

<br/>

### 4. AXIOS ì¸í„°ì…‰í„° ì‚¬ìš©í•˜ê¸°

ê°ê°ì˜ reaquesterëŠ” ì„œë¡œ ë‹¤ë¥¸ ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” ë‹¤ë¥¸ ì„œë²„ì´ê¸° ë•Œë¬¸ì— requester ë³„ë¡œ ë‹¤ë¥¸ í—¤ë”ë¥¼ ì„¤ì •í•´ì¤˜ì•¼ í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ **ì¸í„°ì…‰í„° ê¸°ëŠ¥**ì„ ì‚¬ìš©í•˜ì—¬ requesterì— ë”°ë¼ ë¹„ë™ê¸° í˜¸ì¶œ ë‚´ìš©ì„ ì¶”ê°€í•´ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. ë˜í•œ API ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•  ë•Œ í•˜ë‚˜ì˜ ì—ëŸ¬ ê°ì²´ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```ts
const apiRequester: AxiosInstance = axios.create({
  baseURL: "https://api.baemin.com",
  timeout: 5000,
});

const setRequestDefaultHeader = (requestConfig: AxiosRequestConfig) => {
  const config = requestConfig;

  config.headers = {
    ...config.headers,
    "Content-Type": "application/json;charset=utf-8",
    user: getUserToken(),
    agent: getAgent(),
  };

  return config;
};

const setOrderRequestDefaultHeader = (requestConfig: AxiosRequestConfig) => {
  const config = requestConfig;

  config.headers = {
    ...config.headers,
    "Content-Type": "application/json;charset=utf-8",
    "order-client": getOrderClientToken(),
  };

  return config;
};

// `interceptor` ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ headerë¥¼ ì„¤ì •í•˜ëŠ” ê¸°ëŠ¥ì„ ë„£ê±°ë‚˜ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
apiRequester.interceptors.request.use(setRequestDefaultHeader);

// ì£¼ë¬¸ ì²˜ë¦¬í•˜ëŠ” ì„œë²„
const orderApiRequester: AxiosInstance = axios.create({
  baseURL: orderApiBaseUrl,
  ...defaultConfig,
});

// ê¸°ë³¸ apiRequesterì™€ëŠ” ë‹¤ë¥¸ headerë¥¼ ì„¤ì •í•˜ëŠ” `interceptors`
orderApiRequester.interceptor.request.use(setOrderRequestDefaultHeader);

// `interceptors`ë¥¼ ì‚¬ìš©í•´ httpError ê°™ì€ API ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆë‹¤
orderApiRequester.interceptors.response.use(
  (response: AxiosResponse) => response,
  httpErrorHandler
);

// ì¥ë°”êµ¬ë‹ˆ ì²˜ë¦¬í•˜ëŠ” ì„œë²„
const orderCartApiRequester: AxiosInstance = axios.create({
  baseURL: orderCartApiBaseUrl,
  ...defaultConfig,
});

orderCartApiRequester.interceptor.request.use(setRequestDefaultHeader);
```

#### ë¹Œë” íŒ¨í„´(Builder Pattern)

- ê°ì²´ ìƒì„±ì„ ë” í¸ë¦¬í•˜ê³  ê°€ë…ì„± ìˆê²Œ ë§Œë“¤ê¸° ìœ„í•œ ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜.
- ì£¼ë¡œ ë³µì¡í•œ ê°ì²´ì˜ ìƒì„±ì„ ë‹¨ìˆœí™”í•˜ê³ , ê°ì²´ ìƒì„± ê³¼ì •ì„ ë¶„ë¦¬í•˜ì—¬ ê°ì²´ë¥¼ ì¡°ë¦½í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•¨.

#### ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ

- ì–´ë–¤ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê¸°ë³¸ì ì¸ ì½”ë“œë¥¼ ë§í•¨.
- ex) APIë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•œ ê¸°ë³¸ì ì¸ ì„¤ì •ê³¼ ì¸í„°ì…‰í„° ë“±ì„ ì„¤ì •í•˜ëŠ” ë¶€ë¶„

### 5. API ì‘ë‹µ íƒ€ì… ì§€ì •í•˜ê¸°

ê°™ì€ ì„œë²„ì—ì„œ ì˜¤ëŠ” ì‘ë‹µì˜ í˜•íƒœëŠ” ëŒ€ì²´ë¡œ í†µì¼ë˜ì–´ ìˆì–´ í•˜ë‚˜ì˜ Response íƒ€ì…ìœ¼ë¡œ ë¬¶ì¼ ìˆ˜ ìˆë‹¤.

```ts
interface Response<T> {
  data: T;
  status: string;
  serverDateTime: string;
  errorCode?: string; // FAIL,ERROR
  errorMessage?: string; // FAIL,ERROR
}

const fetchCart = (): AxiosPromise<Response<FetchCartResponse>> =>
  apiRequester.get<Response<FetchCartResponse>>("cart");

const postCart = (
  postCartRequest: PostCartRequest
): AxiosPromise<Response<PostCartResponse>> =>
  apiRequester.post<Response<PostCartResponse>>("cart", postCartRequest);
```

#### ì£¼ì˜í•  ì  ğŸš¨

Response íƒ€ì…ì€ apiRequester ë‚´ì—ì„œ ì²˜ë¦¬í•˜ë©´ UPDATEë‚˜ CREATEê°™ì´ ì‘ë‹µì´ ì—†ì„ ìˆ˜ ìˆëŠ” APIë¥¼ ì²˜ë¦¬í•˜ê¸° ê¹Œë‹¤ë¡œì›Œì§„ë‹¤. ë”°ë¼ì„œ Response íƒ€ì…ì€ apiRequesterì™€ ë¶„ë¦¬í•´ì„œ ê´€ë¦¬í•œë‹¤.

```ts
const updateCart = (
  updateCartRequest
): AxiosPromise<Response<FetchCartResponse>> => apiRequester.get<null>("cart");
```

<br/>

API ìš”ì²­ ë° ì‘ë‹µ ê°’ ì¤‘ì—ì„œ í•˜ë‚˜ì˜ API ì„œë²„ì—ì„œ ë‹¤ë¥¸ API ì„œë²„ë¡œ ë„˜ê²¨ì£¼ê¸°ë§Œ í•˜ëŠ” ê°’ë„ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.  
í•´ë‹¹ ê°’ì— ì–´ë–¤ ì‘ë‹µì´ ë“¤ì–´ìˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ê±°ë‚˜ ê°’ì˜ í˜•ì‹ì´ ë‹¬ë¼ì§€ë”ë¼ë„ ë¡œì§ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” unknown íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ ì•Œ ìˆ˜ ì—†ëŠ” ê°’ì„ì„ í‘œí˜„í•œë‹¤.

```ts
interface response {
  data: {
    cartItems: CartItem[];
    forPass: unknown;
  };
}
```

### Superstructë¥¼ ì‚¬ìš©í•´ ëŸ°íƒ€ì„ì—ì„œ ì‘ë‹µ íƒ€ì… ê²€ì¦í•˜ê¸°

#### Superstructì˜ íŠ¹ì§•

- Superstructë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸í„°í˜ì´ìŠ¤ ì •ì˜ì™€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë°ì´í„°ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤.
- SuperstructëŠ” ëŸ°íƒ€ì„ì—ì„œì˜ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µí•´ ê°œë°œìì™€ ì‚¬ìš©ìì—ê²Œ ìì„¸í•œ ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ê³ ì•ˆë˜ì—ˆë‹¤.

#### Superstructì˜ ì‚¬ìš© ì˜ˆì‹œ

```js
import {
  assert,
  is,
  validate,
  object,
  number,
  string,
  array,
} from "superstruct";

// ë³€ìˆ˜ Articleì€ Superstructì˜ object() ëª¨ë“ˆì˜ ë°˜í™˜ ê²°ê³¼
const Article = object({
  id: number(),
  title: string(),
  tags: array(string()),
  author: object({
    id: number(),
  }),
});

const data = {
  id: 34,
  title: "Hello World",
  tags: ["news", "features"],
  author: {
    id: 1,
  },
};

// ë°ì´í„°ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ë„ì™€ì£¼ëŠ” ëª¨ë“ˆ
assert(data, Article);
is(data, Article);
validate(data, Article);
```

assert, is, validate ëª¨ë“ˆ

- ê³µí†µì  : ë°ì´í„° ì •ë³´ë¥¼ ë‹´ì€ data ë³€ìˆ˜ì™€ ë°ì´í„° ëª…ì„¸ë¥¼ ê°€ì§„ ìŠ¤í‚¤ë§ˆì¸ Articleì„ ì¸ìë¡œ ë°›ì•„ ë°ì´í„°ê°€ ìŠ¤í‚¤ë§ˆì™€ ë¶€í•©í•˜ëŠ”ì§€ ê²€ì‚¬í•¨
- ì°¨ì´ì  : ëª¨ë“ˆë§ˆë‹¤ ë°ì´í„°ì˜ ìœ íš¨ì…©ì„ ë‹¤ë¥´ê²Œ ì ‘ê·¼í•˜ê³  ë°˜í™˜ ê°’ í˜•íƒœê°€ ë‹¤ë¦„
  - **assert** : ìœ íš¨í•˜ì§€ ì•Šì„ ê²½ìš° ì—ëŸ¬ë¥¼ ë˜ì§
  - **is** : ìœ íš¨ì„± ê²€ì‚¬ ê²°ê³¼ì— ë”°ë¼ true or falseë¥¼ ë°˜í™˜í•¨
  - **validate** : [error, data] í˜•ì‹ì˜ íŠœí”Œì„ ë°˜í™˜í•¨. ìœ íš¨í•˜ì§€ ì•Šì„ ë•ŒëŠ” ì—ëŸ¬ ê°’ì´ ë°˜í™˜ë˜ê³ , ìœ íš¨í•  ë•ŒëŠ” ì²« ë²ˆì§¸ ìš”ì†Œë¡œ undefined, ë‘ ë²ˆì§¸ ìš”ì†Œë¡œ data valueê°€ ë°˜í™˜ëœë‹¤.

#### with íƒ€ì…ìŠ¤í¬ë¦½íŠ¸

```ts
type User = {
  id: number;
  email: string;
  name: string;
};

import { assert } from "superstruct";

// Superstructì˜ assert ë©”ì„œë“œë¥¼ í†µí•´ ì¸ìë¡œ ë°›ëŠ” userê°€ User íƒ€ì…ê³¼ ë§¤ì¹­ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ 
function isUser(user: User) {
  assert(user, User);
  console.log("ì ì ˆí•œ ìœ ì €ì…ë‹ˆë‹¤");
}
```

### ì‹¤ì œ API ì‘ë‹µ ì‹œì˜ Superstruct í™œìš© ì‚¬ë¡€

ì‘ì„±ì¤‘...
