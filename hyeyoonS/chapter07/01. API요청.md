# APIìš”ì²­

## **ê¸°ë³¸: fetchë¡œ API ìš”ì²­í•˜ê¸°**

```tsx
const CartBadge: React.FC = () => {
  const [cartCount, setCartCount] = useState(0);
  useEffcet(() => {
    fetch('URLì£¼ì†Œ').then(({ cartItem }) => {
      setCartCount(cartItem.length);
    });
  }, []);
};
```

<ì˜ˆì‹œ: fetchí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ì‚¬ìš©ìê°€ ë‹´ì€ ì¥ë°”êµ¬ë‹ˆì˜ ê°¯ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œ>

### ë¬¸ì œìƒí™©

ì˜ˆì‹œ ì½”ë“œ ì™¸ì—ë„ ì—¬ëŸ¬ ê³³ì—ì„œ ë™ì¼í•œ URLì„ ì‚¬ìš©í•œ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤ê³  ê°€ì •í•œë‹¤.

ë°±ì—”ë“œì—ì„œ ê¸°ëŠ¥ ë³€ê²½ì„ ìœ„í•˜ì—¬ APIì˜ URLì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ê²½ìš°ë‚˜, APIìš”ì²­ì— ì»¤ìŠ¤í…€ í—¤ë”ê°€ í•„ìš”í•œ ê²½ìš° ë“± 

â‡’ APIìš”ì²­ ì •ì±…ì´ ë³€ê²½ë  ê²½ìš° `ê´€ë ¨ëœ ëª¨ë“  ë¹„ë™ê¸° í˜¸ì¶œì„ ìˆ˜ì •`í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ / ì½”ë“œê°€ 58141231ì¤„ì´ë¼ë©´â€¦.? 

### í•´ê²°ë²•

### 1. ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¡œ ë¶„ë¦¬í•˜ê¸°

ì´ëŸ¬í•œ ë¬¸ì œ ìƒí™©ì˜ ì˜ˆë°©ì„ ìœ„í•˜ì—¬, ë¹„ë™ê¸° í˜¸ì¶œ ì½”ë“œëŠ” ì»´í¬ë„ŒíŠ¸ ì˜ì—­ì—ì„œ ë¶„ë¦¬ë˜ì–´ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì—ì„œ ì²˜ë¦¬ë˜ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.

â‡’ fetchí•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¡œ ì´ë™í•˜ê³  ì»´í¬ë„ŒíŠ¸ëŠ” ì„œë¹„ìŠ¤ ë ˆì´ì–´ì˜ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ê·¸ ê²°ê³¼ë¥¼ ë°›ì•„ì™€ ë Œë”ë§ í•˜ëŠ” íë¦„

### í•˜ì§€ë§Œ ë¶„ë¦¬ê°€ ëª¨ë“  í•´ê²° ë²•ì€ ì•„ë‹ˆë‹¤!

â†’ APIìš”ì²­ ì •ì±…ì´ ë³€ê²½ë˜ëŠ” ê²½ìš° `ì§ì ‘ì ì¸ í•¨ìˆ˜ì˜ ìˆ˜ì •`ì´ ë¶ˆê°€í”¼í•˜ê¸° ë•Œë¬¸

## 2. Axios í™œìš©í•˜ê¸°

### ğŸ¤”ì™œ ì“°ì§€? ë” í¸í•˜ë‹ˆê¹Œ!

- fetchì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•˜ì—¬ëŠ” ì§ì ‘ êµ¬í˜„ì„ í•´ì•¼ í•˜ëŠ”ë°, ë²ˆê±°ë¡œìš´ ë°” ê°„í¸í•œ axios ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.

### ì„œë¡œ ë‹¤ë¥¸ URLë¡œ APIìš”ì²­ì„ í•´ì•¼ í•˜ëŠ” ê²½ìš°

- API Entryê°€ 2ê°œ ì´ìƒì¸ ê²½ìš°ì—ëŠ” ê° ì„œë²„ì˜ ê¸°ë³¸ URLì„ í˜¸ì¶œí•˜ë„ë¡ 2ê°œ ì´ìƒì˜ APIìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ êµ¬ì„±í•´ì•¼ í•œë‹¤. ì´í›„ ë‹¤ë¥¸ URLë¡œ ì„œë¹„ìŠ¤ ì½”ë“œë¥¼ í˜¸ì¶œí•  ë•Œ ê°ê°ì˜ apiRequesterë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```tsx
import axios, { AxiosRequestConfig } from 'axios';

// ê¸°ë³¸ ì„¤ì • ê°ì²´
const defaultConfig: AxiosRequestConfig = {
  baseURL: 'https://api.example.com', // ê¸°ë³¸ URL
  headers: {
    'Content-Type': 'application/json', // ê¸°ë³¸ í—¤ë”
  },
  timeout: 10000, // ê¸°ë³¸ íƒ€ì„ì•„ì›ƒ
};

//ê¸°ë³¸ì ì¸ API ì—”íŠ¸ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” Axios ì¸ìŠ¤í„´ìŠ¤
const apiRequester: AxiosInstance = axios.create(defaultConfig);

//ë‹¤ë¥¸ API ì—”íŠ¸ë¦¬ì¸ "https://api.baemin.or/" ì£¼ì†Œë¡œ ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•œ Axios ì¸ìŠ¤í„´ìŠ¤
const orderApiRequester: AxiosInstance = axios.create({
  baseURL: 'https://api.baemin.or/',
  ...defaultConfig,
});

//ë‹¤ë¥¸ API ì—”íŠ¸ë¦¬ì¸ "https://api.order/" ì£¼ì†Œë¡œ ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•œ Axios ì¸ìŠ¤í„´ìŠ¤
const orderCartApiRequester: AxiosInstance = axios.create({
  baseURL: 'https://api.order/',
  ...defaultConfig,
});
```

## 3. Axios ì¸í„°ì…‰í„° í™œìš©í•˜ê¸°

ê° requesterë³„ë¡œ ì»¤ìŠ¤í…€ í—¤ë”ë¥¼ ì„¤ì •ì„ í•´ì•¼ í•˜ëŠ” ê²½ìš°

- ê°ê°ì˜ RequesterëŠ” ì„œë¡œ ë‹¤ë¥¸ ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” ë°”, Requesterë³„ë¡œ ë‹¤ë¥¸ í—¤ë”ë¥¼ ì„¤ì •í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤. ì´ ë•Œ ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•˜ì—¬ Requesterì— ë”°ë¼ ë¹„ë™ê¸° í˜¸ì¶œì„ ë‚´ìš©ì— ì¶”ê°€í•´ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
- interceptorë¡œ ê°ê° ë‹¤ë¥¸ headerë¥¼ ì„¤ì •í•˜ê±°ë‚˜, APIì—ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```tsx
const apiRequester : AxiosInstance = axiost.create({
    baseURL:"https://api.baemin.com/",
    timeout:5000
});

const setRequesterDefaultHeader = (requestConfig: AxiosRequestConfig) => {
    const config = requestConfig;

    config.headers = {
        ...config.headers,
        "Content-Tyep":"application/json;charset=utf8",
        user:getUserToken(),
        agent:getAgent()
    }

    return config;
}

const setOrderRequesterDefaultHeader = (requestConfig: AxiosRequestConfig) => {
    const config = requestConfig;

    config.headers = {
        ...config.headers,
        "Content-Tyep":"application/json;charset=utf8",
        "order-client": getOrderClienToken();
    }

    return config;
}

//  Axios ìš”ì²­ ë””í´íŠ¸ ì¸í„°ì…‰í„° ë“±ë¡
apiRequester.interceptors.request.use(setRequesterDefaultHeader)
const orderApiRequester: AxiosInstance = axios.create({
    baseURL:orderApiBaseUrl,
    ...defaultConfig,
})

//ì£¼ë¬¸ê´€ë ¨ API ì „ìš© í—¤ë” ê°’ì„ ì„¤ì •í•˜ëŠ” Axios ìš”ì²­ ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡
orderApiRequester.interceptors.reuquest.use(setOrderRequesterDefaultHeader)
//ì• ëŸ¬ ê°ì²´ë¥¼ í•¸ë“¤ë§í•˜ëŠ” httpErrorHandler
orderApiRequester.interceptors.response.use({
    (response: AxiosResponse) => response,
    httpErrorHandler
})
const orderCartApiRequester: AxiosInstance = axios.create({
    baseURL:orderCartApiBaseUrl,
    ...defaultConfig,
})

```

## 3-1. ë¹Œë” íŒ¨í„´ í™œìš©í•˜ê¸°

ìš”ì²­ ì˜µì…˜ì— ë”°ë¼ ë‹¤ë¥¸ ì¸í„°ì…‰í„°ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ë¹Œë” íŒ¨í„´ì„ ì¶”ê°€í•˜ì—¬ APIBuilderê°™ì€ í´ë˜ìŠ¤ í˜•íƒœë¡œ êµ¬ì„±í•˜ê¸°ë„ í•œë‹¤.

```tsx
class API {
	readonly method: HTTPMethod;
	readonly url: string;
	baseurl?: string;
	headers?: HTTPHeaders;
	params?: HTTPParams;
	data?: unknown;
	timeout?: number;
	withCredentials: boolean;
	
	constructor(method: HTTPMethod, url: string) {
		this.method = method;
		this.url: url;
		}
	}
	
	call<T>(): AxiosPromise<T> {
		const http: axios.create();
	}
	
	if (this.withCredentials) {
		http.interceptors.response.use(
			response => response,
			error => {
				if (error.response && error.response.status === 401) {
				//ì—ëŸ¬ ì²˜ë¦¬ ì–´ì©Œêµ¬ì €ì©Œêµ¬ ë¡œì§
				}
				return Promise.reject(error);
				}
			);
		}
		
		return http.request({...this}
		}
	}
	
```

```tsx
class APIBuilder {
	private _instance: API;
	
	constructor(method: HTTPMethod, url: string, data?: unknown){
		this._instance = new API(method, url);
		this._instance.baseURL = apiHost;
		this._instance.data = data;
		this._instance.header = {
			'Content-Type': 'application/json; charset=urf-8',
		}
		this._instance.timeout = 5000;
		this._instance.withCredentials = flase;
		}
}
```

### ğŸ¤”ë¹Œë” íŒ¨í„´ì´ ë­ì§€?

- ê°ì²´ ìƒì„±ì„ ë‹¨ìˆœí™”í•˜ê³ , ê°ì²´ ìƒì„± ê³¼ì •ì„ ë¶„ë¦¬í•˜ì—¬ ê°ì²´ë¥¼ ì¡°ë¦½í•˜ëŠ” ë°©ë²•
ê°ì²´ ìƒì„±ì„ ë” í¸ë¦¬í•˜ê³  ê°€ë…ì„± ìˆê²Œ ë§Œë“¤ê¸° ìœ„í•œ ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜
- `ì¥ì `: ì˜µì…˜ì´ ë‹¤ì–‘í•œ ê²½ìš° ì¸í„°ì…‰í„°ë¥¼ ì„¤ì • ê°’ì— ë”°ë¼ ì ìš©í•˜ê³ , í•„ìš” ì—†ëŠ” ì¸í„°ì…‰í„°ë¥¼ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
- `ë‹¨ì `: ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œê°€ ë§ë‹¤.

## **4. API ì‘ë‹µ íƒ€ì… ì§€ì •í•˜ê¸°**

- ê°™ì€ ì„œë²„ì—ì„œ ì˜¤ëŠ” ì‘ë‹µì˜ í˜•íƒœëŠ” ëŒ€ì²´ë¡œ í†µì¼ë˜ì–´ ìˆìœ¼ë¯€ë¡œ í•˜ë‚˜ì˜ Response íƒ€ì…ìœ¼ë¡œ ë¬¶ì¼ ìˆ˜ ìˆë‹¤.

```tsx
interface Response<T> {
  data: T;
  status: string;
  serverDateTime: string;
  errorCode?: string;
  errorMessage?: string;
}

```

## 5. View Model ì‚¬ìš©í•˜ê¸°

### ğŸ¤”ì™œ ì“°ì§€?

- APIì‘ë‹µì´ ë°”ë€Œì–´ë„ UIê°€ ê¹¨ì§€ì§€ ì•Šê²Œ ê°œë°œí•  ìˆ˜ ìˆë‹¤.
