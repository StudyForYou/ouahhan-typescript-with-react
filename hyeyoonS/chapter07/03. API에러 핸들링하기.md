# API ì—ëŸ¬ í•¸ë“¤ë§

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê³  ëª…ì‹œí•˜ëŠ” ë°©ë²•

## 1. íƒ€ì… ê°€ë“œ í™œìš©í•˜ê¸°

- Axios ë¼ì´ë¸ŒëŸ¬ë¦¬ : isAxiosErrorë¼ëŠ” íƒ€ì… ê°€ë“œë¥¼ ì œê³µ!
- ì„œë²„ ì—ëŸ¬ì„ì„ ëª…í™•í•˜ê²Œ í‘œì‹œí•˜ê³  ì„œë²„ì—ì„œ ë‚´ë ¤ì£¼ëŠ” ì—ëŸ¬ ì‘ë‹µ ê°ì²´ì— ëŒ€í•´ì„œë„ êµ¬ì²´ì ìœ¼ë¡œ ì •ì˜í•¨ìœ¼ë¡œì¨ ì—ëŸ¬ ê°ì²´ê°€ ì–´ë–¤ ì†ì„±ì„ ê°€ì¡ŒëŠ”ì§€ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

```tsx
// ê³µí†µ ì—ëŸ¬ê°ì²´ì— ëŒ€í•œ íƒ€ì…

interface ErrorResponse {
  status: string;
  serverDateTime: string;
  errorCode: string;
  errorMessage: string;
}
```

- `ErrorResponse`Â ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬Â `AxiosError<ErrorResponse>`í˜•íƒœë¡œ Axios ì—ëŸ¬ í‘œí˜„ ê°€ëŠ¥

 â‡’  ì‚¬ìš©ì ì •ì˜ íƒ€ì…ê°€ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ëª…ì‹œì ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤! 

```tsx
function isServerError(error: unknown): error is AxiosError<ErrorResponse> {
  return axios.isAxiosError(error);
}

const onClickDeleteHistoryButton = async (id: string) => {
  try {
    await axios.post('URL', { id });
    alert('ì£¼ë¬¸ë‚´ì—­ ì‚­ì œ');
  } catch (e: unknown) {
    // ì—ëŸ¬ê°€ Axios ì—ëŸ¬ì´ë©° ErrorResponseì˜ í˜•íƒœë¥¼ ì§€ë‹ˆê³  ìˆê³ , ì„œë²„ ì‘ë‹µì´ ì¡´ì¬í•˜ë©°, ê·¸ ì‘ë‹µì—ëŠ” errorMessage ì†ì„±ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°
    if (isServerError(e) && e.response && e.response.data.errorMessage) {
      // trueì¼ ê²½ìš° ëª…ì‹œì ìœ¼ë¡œ ì„œë²„ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê³  ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì„¤ì •
      setErrorMessage(e.response.data.errorMessage);
    }
    // falseì¼ ê²½ìš° ì¼ë°˜ì ì¸ ì¼ì‹œì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì„¤ì •
    setErrorMessage('ì¼ì‹œì ì¸ ì—ëŸ¬ê°€ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”');
  }
};
```

## 2. ì—ëŸ¬ ì„œë¸Œí´ë˜ì‹±í•˜ê¸°

- ì—ëŸ¬ëŠ” ì„œë²„ ë¿ ì•„ë‹ˆë¼ ì¸ì¦, ë„¤íŠ¸ì›Œí¬, íƒ€ì„ì•„ì›ƒ ë“± ë‹¤ì–‘í•œ ì›ì¸ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ë°”, ì´ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œí•˜ê¸° ìœ„í•´ ì„œë¸Œí´ë˜ì‹±ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤.

> ğŸ¤” ì„œë¸Œí´ë˜ì‹±(SubClassing)ì´ë€? </br>
-ê¸°ì¡´ í´ë˜ìŠ¤ë¥¼ í™•ì¥í•˜ì—¬ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ë§Œë“œëŠ” ê³¼ì • </br>
-ìƒˆë¡œìš´ í´ë˜ìŠ¤ëŠ” ìƒìœ„ í´ë˜ìŠ¤ì˜ ëª¨ë“  ì†ì„±ê³¼ ë©”ì†Œë“œë¥¼ ìƒì†ë°›ì•„ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ì¶”ê°€ ì†ì„±ê³¼ ë©”ì†Œë“œë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤
> 

```tsx
// ê¸°ì¡´ ì½”ë“œ : ì—ëŸ¬ ë°œìƒì‹œ ì—ëŸ¬ì— ë‹´ê¸´ ë©”ì„¸ì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ altertë¡œ ë³´ì—¬ì¤€ë‹¤
const getOrderHistory = async (page:number) => Promise<History> {
  try {
    const data = await axios.get("APIURL");
    const history = await JSON.parse.(data);
    } catch (e) {
      alert(e.message)
    }
  }
```

```tsx
// ì„œë¸Œí´ë˜ì‹±ì„ í™œìš©í•˜ê¸° ìœ„í•œ ì—ëŸ¬ í´ë˜ìŠ¤ ì •ì˜
class OrderHttpError extends Error {

  private readonly privateResponse: AxiosResponse<ErrorResponse : undfiend>

  constructor(message?: string, response?:AxiosResponse<ErrorResponse>){
    super(message);
    this.name = "OrderHttpError"
    this.privateResponse = response
  }

  get response(): AxiosResponse<ErrorResponse> | undfined {
    return this.privateResponse
  }
}

class NetworkError extends Error{
    constructor(message: ""){
    super(message);
    this.name = "NetworkError"
  }
}

class UnauthorizedError extends Error{
    constructor(message?: string, response?:AxiosResponse<ErrorResponse>){
    super(message, response);
    this.name = "Unauthorized"
  }
}
```

```tsx
//ì˜ˆì‹œ 1. ì£¼ë¬¸ ë‚´ì—­ì„ ê°€ì ¸ì˜¤ë©´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ì˜ ì˜ˆì‹œ
const fetchOrderHistory = async () => {
  try {
    const response = await apiRequester.get('/order-history');
    console.log('Order history data received:', response.data);
  } catch (error: unknown) {
    if (error instanceof AxiosError) {
      if (error.response) {
        const { status, data } = error.response;
        const { errorCode, errorMessage } = data;

        if (status === 401) {
          // UnauthorizedError
          throw new UnauthorizedError(errorMessage, error.response);
        } else {
          // OrderHttpError
          throw new OrderHttpError(errorMessage, error.response);
        }
      } else if (error.request) {
        // ìš”ì²­ ì „ì†¡ í›„ ì‘ë‹µì´ ì—†ëŠ” ê²½ìš°
        throw new NetworkError('No response received');
      } else {
        // ìš”ì²­ ì „ì†¡ ì „ì— ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°
        throw new NetworkError('Request error');
      }
    } else {
      // Axios ì—ëŸ¬ê°€ ì•„ë‹Œ ê²½ìš°
      throw error;
    }
  }
};
```

## 3. ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•œ ì—ëŸ¬ ì²˜ë¦¬

- Axiosì—ì„œ ì œê³µí•˜ëŠ” interceptors ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ HTTPì—ëŸ¬ì— ì¼ê´€ëœ ë¡œì§ì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.

> ğŸ¤”Axios Interceptors ì–´ë–»ê²Œ ì“°ì§€?</br>
axios.interceptors.response.use() í˜•íƒœ </br>
use í•¨ìˆ˜ì— ë‘ ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆë‹¤ </br>
       - ì²« ë²ˆì§¸ í•¨ìˆ˜ (onFulfilled):  ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ë°›ì•˜ì„ ë•Œ í˜¸ì¶œ </br>
       - ë‘ ë²ˆì§¸ í•¨ìˆ˜ (onRejected): ì‘ë‹µì´ ì‹¤íŒ¨í–ˆì„ ë•Œ, ì¦‰ HTTP ìš”ì²­ì´ ì‹¤íŒ¨í•˜ê±°ë‚˜ ì„œë²„ì—ì„œ ì—ëŸ¬ ì‘ë‹µì„ ë°˜í™˜í–ˆì„ ë•Œ í˜¸ì¶œ </br>
    
> 


```tsx
const httpErrorHandler = (
  error: AxiosError<ErrorResponse> | Error
): Promise<Error> => {
  (error) => {
    if (error.response && error.response.stauts === '401') {
      window.location.href = `/login`;
    }
    return Promise.reject(error);
  };
};

orderApiRequester.interceptors.response.use(
  // ì‘ë‹µ ì„±ê³µì‹œ
  (response: AxiosResponse) => response,
  // ì‘ë‹µ ì‹¤íŒ¨ì‹œ httpErrorHandler() í˜¸ì¶œ
  httpErrorHandler
);
```

## 4. ì—ëŸ¬ ë°”ìš´ë”ë¦¬ë¥¼ í™œìš©í•œ ì—ëŸ¬ ì²˜ë¦¬

> ğŸ¤”ì—ëŸ¬ ë°”ìš´ë”ë¦¬ê°€ ë­ì§€? </br>
- ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ê³µí†µìœ¼ë¡œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸
> 

- ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ í•˜ìœ„ì— ìˆëŠ” ì»¤í¬ë„ŒíŠ¸ì—ì„œ ë°œìƒí•œ ì—ëŸ¬ë¥¼ ìºì¹˜í•˜ê³ , `ê°€ì¥ ê°€ê¹Œìš´ ë¶€ëª¨` ì—ëŸ¬ ë°”ìš´ë”ë¦¬ì—ì„œ ì²˜ë¦¬ ê°€ëŠ¥
- `ì—ëŸ¬ ë°œìƒ ì»´í¬ë„ŒíŠ¸ ëŒ€ì‹ ì— ì—ëŸ¬ë¥¼ ì²˜ë¦¬`í•˜ê±°ë‚˜, `ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬ë¥¼ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬`í•´ì•¼ í•  ë•Œ

```tsx
import React, { Component, ErrorInfo, ReactNode } from 'react';

interface ErrorBoundaryProps {
  children: ReactNode;
}

interface ErrorBoundaryState {
  hasError: boolean;
}

class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);
    this.state = { hasError: false };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error, errorInfo);
    this.setState({ hasError: true });
  }

  render() {
    if (this.state.hasError) {
      // ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì—ëŸ¬ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬í„´
      return <ErrorPage />;
    }

    return this.props.children;
  }
}

function App() {
  return (
    <ErrorBoundary>
      <OrderHistoryPage />
    </ErrorBoundary>
  );
}

export default App;
```

## 5. ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì—ëŸ¬ ì²˜ë¦¬

```tsx
import { atom, useAtom } from 'jotai';

// ì—ëŸ¬ ìƒíƒœë¥¼ ìœ„í•œ atom ì •ì˜
const errorAtom = atom<Error | null>(null);

// fetchData í•¨ìˆ˜ ì •ì˜: ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
async function fetchData() {
  try {
    // ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰ (ì˜ˆ: API í˜¸ì¶œ)
    const response = await apiRequester.get('/data');
    const data = response.data;
    
    // ë°ì´í„° ì²˜ë¦¬ ë“± í•„ìš”í•œ ì‘ì—… ìˆ˜í–‰
  } catch (error) {
    // ì—ëŸ¬ ë°œìƒ ì‹œ ì—ëŸ¬ ìƒíƒœ ì—…ë°ì´íŠ¸
    setError(error);
  }
}

// ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ useAtomì„ ì‚¬ìš©í•˜ì—¬ ì—ëŸ¬ ìƒíƒœë¥¼ êµ¬ë…í•˜ê³  ê´€ë¦¬
function MyComponent() {
  const [error, setError] = useAtom(errorAtom);

  return (
    <div>
      {/* ì—ëŸ¬ê°€ ìˆì„ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥ */}
      {error && <p>Error: {error.message}</p>}
      
      {/* ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë²„íŠ¼ */}
      <button onClick={fetchData}>Fetch Data</button>
    </div>
  );
}
```

## 6. ë¦¬ì•¡íŠ¸ì¿¼ë¦¬ë¥¼ í™œìš©í•œ ì—ëŸ¬ ì²˜ë¦¬

- React-Query, swrê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìš”ì²­ì— ëŒ€í•œ ìƒíƒœë¥¼ ë°˜í™˜í•´ì¤Œ â‡’ ìš”ì²­ ìƒíƒœë¥¼ í™•ì¸í•˜ê¸° ì‰½ë‹¤!

```tsx
const JobComponent: React.FC = () => {
  // ìš”ì²­ì— ëŒ€í•œ ìƒíƒœë¥¼ ë°˜í™˜
  const { isError, error, isLoading, data } = useFetchJobList();

  // ì—ëŸ¬ ë°œìƒ
  if (isError) {
    return <div>{`${error.message}`}ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”</div>;
  }

  // ë¡œë”©
  if (isLoading) {
    return <div>ë¡œë”© ì¤‘ì…ë‹ˆë‹¤</div>;
  }

  // ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ì‹œ í™”ë©´ì— ë°ì´í„° ì¶œë ¥
  return (
    <>
      {data.map((job) => (
        <JobItem key={job.id} job={job} />
      ))}
    </>
  );
};
```

## 7. ê·¸ë°–ì˜ ì—ëŸ¬ ì²˜ë¦¬

### ì˜ˆì‹œ: 200ì‘ë‹µê³¼ í•¨ê»˜ ì‘ë‹µ ë°”ë””ì— ë³„ë„ì˜ ìƒíƒœ ì½”ë“œë¥¼ ì „ë‹¬í•˜ëŠ” ì»¤ìŠ¤í…€ ì—ëŸ¬

- ì„±ê³µ ì‘ë‹µì— ëŒ€í•œ ì—ëŸ¬ ì²˜ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆë‹¤!

```tsx
//ì„±ê³µ ì‘ë‹µì´ì§€ë§Œ ì—ëŸ¬ ì²˜ë¦¬ê°€ í•„ìš”í•œ ì‘ë‹µ ì˜ˆì‹œ
httpStatus:200
{
  "status":"C2005",// ì‘ë‹µ ë°”ë””ì— ë³„ë„ì˜ ìƒíƒœ ì½”ë“œì™€ ë©”ì„¸ì§€ ì „ë‹¬
  "message":"ì¥ë°”êµ¬ë‹ˆì— í’ˆì ˆëœ ë©”ë‰´ê°€ ìˆìŠµë‹ˆë‹¤"
}
```

### í•´ê²°ì±…

Axiosë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ requesterë¥¼ ë³„ë„ë¡œ ì„ ì–¸í•œë‹¤.
ì´í›„ ìƒíƒœ ì½”ë“œ ë¹„êµ ë¡œì§ì„ ì¸í„°ì…‰í„°ì— ì¶”ê°€í•œë‹¤.

```tsx
const apiRequester: AxiosInstance = axiost.create({
  baseorderAURL: orderApiBaseUrl,
  ...defaultConfig,
});

export const httpSuccesHandelr = (response: AxiosResponse) => {
  if (response.data.status !== 'SUCCESS') {
    throw new CustomError(response.data.message, response);
  }

  return response;
};

apiRequester.interceptors.response.use(httpSuccesHandelr, httpErrorHandler);

const createOrder = (data: CreateOrderData) => {
  try {
    const response = apiRequester.post('PostUrl', data);
    httpSuccesHandelr(response);
  } catch (e) {
    httpErrorHandler(e);
  }
};
```
